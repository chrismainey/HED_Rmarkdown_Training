---
title: "Exercise 14: RMarkdown"
author: "Chris Mainey"
date: "16/09/2019"
output: html_document
params:
  Trust: "Trust1"
---
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown Exercise

This exercise is used to develop a sample report using the `LOS_model` dataset from the `NHSRdatasets` package.
More information about this package is avaialble at:  [here](https://cran.r-project.org/web/packages/NHSRdatasets/index.html).

```{r load, echo = FALSE}
library(NHSRdatasets)
data(LOS_model)
```


## Full dataset statistics

Here is a summary of the LOS using `dplyr`, collapsing the results into a single piece of code, with warnings surpressed, and sending  the using `knitr::kable` on the table to format it nicely. 

```{r summary, collapse=TRUE, message=FALSE}
library(dplyr)
LOS_model %>%
  summarise("Mean LOS" = mean(LOS),
            "Median LOS" = median(LOS))  %>%
  knitr::kable(caption = "LOS_model summary data for all organisations")
```

Now we will create a histogram of the LOS stay:

```{r LOS_all_plot, message=FALSE, fig.retina=2}
library(ggplot2)
ggplot(LOS_model, aes(x=LOS)) +
  geom_histogram(fill="dodgerblue2", alpha=0.6, col=1, bins=12) +
  labs(title = "Length of Stay for all patients in `LOS_models`") +
  scale_x_continuous(name="Length-of-Stay (LOS)")+
  scale_y_continuous(name="Patients")
```

<br><br>
  
***
  
<br><br>
  
## Now parameterised:
 
We will use the same chunks from above, but using `filter` to taget our dataset at a parameter, Trust:1


```{r summary_trust1, collapse=TRUE, message=FALSE}
LOS_model %>%
  filter(Organisation==params$Trust) %>%
  summarise("Mean LOS" = mean(LOS),
            "Median LOS" = median(LOS))  %>%
  knitr::kable(caption = "LOS_model summary data for Trust1")
```

Here I've used the subset function, rathe than filter, as it's another way to do the same thing.  This is base R, so marginally quicker than filter.

```{r LOS_trust1_plot, message=FALSE, fig.retina=2}
ggplot(subset(LOS_model, Organisation==params$Trust), aes(x=LOS)) +
  geom_histogram(fill="dodgerblue2", alpha=0.6, col=1, bins=12) +
  labs(title = paste("Length of Stay for all patients at",  params$Trust, "in `LOS_models`")) +
  scale_x_continuous(name="Length-of-Stay (LOS)")+
  scale_y_continuous(name="Patients")
```