---
title: "CSS with R Markdown"
author: "Anthony Harmon"
date: "2020/02/03 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    chakra: libs/remark-latest.min.js
    css: "libs/HED.css"
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---
# What is CSS?

- CSS stands for Cascading Style Sheets
- They are typically used in conjunction with HTML to help style websites
- They aid with formatting and appearance, allowing for a consistent approach to be used
- Not exclusive to R - used in other programming languages such as Node.js

--

# Do I have to use it?

- No!  It is not required to build Markdown documents
- You can just choose to format area of text using HTML tags or 'free' text
- You may find Markdown's 'base formatting sufficient for your needs

---

# Pros and cons of using CSS

```{css, echo=FALSE}
th {
  background-color: #4CAF50;
  color: white;
}

#Code above is to overwrite the CSS styles from the HED.css example, specifically for this table only
```

```{r tbl1, echo = FALSE}
tbl1 <- tibble::tribble(
~`Pros`, ~`Cons`,
"Consistency across your document","Takes time to code",
"Able to share CSS files to help improve","Can be very sensitive to small changes",
"Simple coding, once you understand how it works","Doesn't always work as you expect it to!  Expect trial and error!",
"Has many options to improve visuals- I still learn new elements regularly!","Unless you code it in a certain way, it can appear differently from computer to computer",
"Well established","CSS files can be considerably lengthy in some instances",
"Has many more formatting options than basic Markdown"," "
)
library(knitr)
library(kableExtra)

dt <- tbl1
kable(dt) %>% 
  kable_styling(bootstrap_options = c("striped", "hover","condensed"))


```

---

# Markdown output without CSS

####Is the default style enough for you??

``` {css, echo=FALSE}
figcaption {
  font-style: italic;
  font-size: smaller;
  text-align: center;
}

.aligncenter {
    text-align: center;
}

```

.pull-left[
<figure>
  <p> <img src='./Assets/no_markdown_output.png' 
  width=130% height=130%>
  <figcaption> Original Markdown output
  </figcaption>
  </p>
</figure>
]

.pull-right[
<figure>
  <p> <img src='./Assets/dataset_without_formatting.png' 
  width=130% height=130%>
  <figcaption> How a dataset appears without formatting
  </figcaption>
  </p>
</figure>
]

---

# What do I need to code in CSS?

.pull-left[
- Notepad!  The most basic of all applications is sufficient
- R Studio also allows you to create text files you can save as CSS


<br>

* Better alternatives do exist - I prefer a program called 'Atom' (free!)
<br>
  + It has colour coding for tag/section/class identification
  + Code suggestions for open tags

]

.pull-right[
<figure>
  <p class="aligncenter"> <img src='./Assets/notepad_css.png' 
  width=100% height=100%>
  <figcaption> Notepad use in CSS
  </figcaption>
  </p>
</figure>

<figure>
  <p class="aligncenter"> <img src='./Assets/Atom_CSS.png' 
  width=75% height=75%>
  <figcaption> Atom view of CSS files
  </figcaption>
  </p>
</figure>

]

---

# Attaching and storing CSS files

At the top of a Markdown document, in the YAML section, you will have see a section that looks similar to the below - 
```{r eval=FALSE}
  title: "Trust review of LOS, 2018 - 2019"
  output:
  html_document:default
  pdf_document: default
```
--
A small change to the `html_document` property attaches a CSS file to the Markdown

```{r eval=FALSE}
  html_document:
    css:styles.css
```
--
## Locating files 

.pull-left[
In a simple implementation of CSS, keep CSS files in the same folder as the Markdown file.  You can however, use sub-directories
]

.pull-right[
<figure>
  <p> <img src='./Assets/file_locations.png' 
  width=100% height=100%>
  <figcaption> Typical folder location
  </figcaption>
  </p>
</figure>
]

---

# HTML tags

+ Not essential for formatting Markdown, but important if you use CSS
+ They identify a section of HTML code and allow you to apply rules to it
+ All tags 'open' and 'close' in a particular way
  + Not following this method causes strange behaviour!

##How they work

+ All tags use angle brackets `<  >` to contain an identifier
+ Opening tags start of a tag and contain the identifier of what you are creating e.g. `<p>`
+ Closing tags use the same content as the opener, but you add a `/` before the content of the tag e.g. `</p>`

---

# Examples of HTML tags

| Code |  Purpose |
| :------------: | :------:|
| `<h4>` | Creates a header tag.  Used to make titles & subtitles|
| `<p>` | Creates a paragraph tag.  Used to put in standard/paragraphed text|
| `<li>`  | Creates a list tag.  Used to make a bullet pointed list|
| `<body>` | This is what HTML elements should be contained in e.g. text, hyperlinks, tables etc.
| `<div>` | Divides the HTML code up into a section, allowing you to refer to that specific block


---

# Internal vs external CSS

+ You can choose to either build your CSS into your Markdown file directly, or...
+ Put it into an external file (the route I prefer!)

--

## Think about your needs...

+ Internal/inline CSS code makes your Markdown file much longer, but it is in one place
+ External CSS means switching backwards and forwards, but is easier to find errors

--

## Today's use of CSS

+ Will be through external files
+ If you look at this Markdown file, you can see how internal CSS works

---

# CSS Rules

All CSS tags start and end with braces/curly brackets `{ }`.  For example -

```{CSS eval=FALSE}
{margin-top:0;
text-align:justify;}
```

<br>
--
CSS mainly uses classes or element selectors.  The key difference is the dot before the reference to the section.  An element selector has no dot -

```{CSS eval=FALSE}
h3 { position:absolute; }
```

<br>
--
A class has a dot before the name of the section  -

```{CSS eval=FALSE}
.sidebar { margin-left:600px;}
```

---
# Further CSS rules

Properties in a CSS file use a colon after the property identifier -

```{CSS eval=FALSE}
footer { text-align:center;}
```

--

At the end of each rule, a semi colon is used

```{CSS eval=FALSE}
header {padding-top:20px;}
```

--

To use a sub-class (change of a property inside of a class), put a space after the class name 
```{CSS eval=FALSE}
.sidebar ul {margin : 0;}
```

--

##Tip of the iceberg...

Go to https://www.w3schools.com/css/ for many more examples

---

# Quick CSS reference guide & examples

| CSS Property | Example | Purpose |
| :------------: | :------:| :-------:|
| margin |`margin-top:100px`|Puts a buffer/margin on the side of something|
| color | `<h1 style=background-color:DodgerBlue;>`|Simply sets the colour of that element.  Can use names or hexadecimal values|
| padding |`div{padding-top:50px};`|Allows a section of space around the area to be added|
| Font-family, font-size | `font-family: Arial; font-weight: bold;`|Allows you to select a specific font(e.g. Arial), size (e.g. 12) and weight (e.g. bold)


---

#Activity 1

| Choice 1 | Choice 2 | Choice 3 |
| :------------: | :------:| :-------:|
| Use an existing R Markdown template I have created and tackle the areas that are commented out (CSS_Activity_1.rmd) in the 'Exercises' folder | Produce an R Markdown with HTML and CSS from scratch that utilise these skills | Adapt an existing R Markdown file that you have used in today's sessions

<br>
<br>

Extension - Add in stylings for bullet points / list elements in your CSS file (may need research)

<br>
<br>

### Look for the below in the code for where to action areas -

``` {diff eval=FALSE}
-<!-- Insert some text below that can be used to introduce the cars dataset (inside the 'p' tags) -->
<p>  </p>
<p>  </p>
<p>  </p>
```
---

# Body formatting

+ Affects ALL elements of the HTML section, unless overriden with other HTML tags
+ For example, adding a `<p>` tag into your body code means that text will then follow the rules of the `<p>` tag, rather than the body tag rules
+ Do not ignore body formatting!  We will investigate this more in the next activity

<br>
--

# Backgrounds in CSS

* Backgrounds be changed in CSS at various levels including -
  + Overall 'body', header, div tags (looked at later), paragraphs and many more
+ Can use the usual colour formatting style e.g. hex, RGB, name values, or can use images

---

# Code examples

```{CSS eval=-FALSE}

body { background-color:lightblue;
}

h1   { background-color:lightblue;
}

div  { background-color:lightblue;
}

p    { background-color:lightblue;
}
```

<br>

Examples above showing you to use CSS to respectively change the `body`, `h1`, `div` and `p` tag content in your document

---

# More complete example and output

.pull-left[

``` {CSS eval=FALSE}

p {
 font-family: Arial;
 font-size: 14px;
 color: #6870B8;
}

body{
  font-family: Verdana;
  font-size:12px;
  color: #303248;
}


```
]
.pull-right[

<figure>
  <p class="aligncenter"> <img src='./Assets/Activity_1_Output.png' 
  width=125% height=125%>
  <figcaption> Output in Markdown
  </figcaption>
  </p>
</figure>

]

---

# Borders in CSS

+ These create 'zones' and borders around text in the same way you would in any application
+ Can choose to put a border around the whole body, some it, individual parts etc.
+ One extra line of code in a CSS section e.g. - `border: 5px solid red;`

<figure>
  <p class="aligncenter"> <img src='./Assets/CSS_border.png' 
  width=75% height=75%>
  <figcaption> Output in Markdown
  </figcaption>
  </p>
</figure>

Further options available at https://www.w3schools.com/css/css_border.asp

---

# Activity 2

+ Add in a suitable 'body' tag in the R Markdown code around the areas that you wish to use it in (you can just keep it as it is, if preferred)
+ Add in background-color (forgive the Americanisation!) property tags into the CSS file for relevant tags of your choice
+ Try using a text and hex value for the colours so that you are aware of how to do it either way
+ Add in some borders to your CSS text.  Try and keep them relevant and not random!

<br>

As before, a 'complete' example of this can be seen in the file called `styles(Activity_2_complete).css`


---

# Using images in a CSS file

+ By using the `background-image` property, you can add a picture to your background  
+ This could be a logo or something similar to represent your trust
+ The default view for this is for the image to repeat itself (if it is not large enough to fit the whole page)

<br>

The code and output might look like this (not good!) - 

| Code <img width=375/>  | Output <img width=375/>  |
|------|--------|
|` body`<br>`{  background-color: #fff;`<br> `background-position: right top;` <br> `background-image:url("Rightblox2.png");`<br>`display: table-cell;`<br>`}`|<p class="aligncenter"><img src='./Assets/CSS_background.png' width=100% height=50%></p></figure> |


---

#  Fixing backgrounds

By adding a line using `background-repeat`, you can prevent the image from repeating.  With a few extra tweaks, the final output is much better
<br>
<br>

| Code <img width=400/>  | Output <img width=400/>   |
|------|--------|
|` body`<br>`{  background-position: right top;`<br> `background-image: url("Rightblox2.png");` <br> `background-repeat: no-repeat;`<br>`display: table-cell;`<br>`}`|<p class="aligncenter"><img src='./Assets/Background_repeat_fixed.png' width=100% height=100%></p></figure> |

---

# Using data in Markdown

+ You have already seen how to use data in Markdown today
+ You can use additional formatting to improve the appearance of these outputs
+ When using the summary function, some data that you see is less relevant than others
<br>
<br>
For example, the highlighted columns below are irrelevant in this context
<br>
<br>
``` {r echo=FALSE} 
library(NHSRdatasets)
data("LOS_model")
LOS_summary <- (summary(LOS_model))
library(kableExtra)

```
``` {r echo = FALSE}

kable(LOS_summary) %>%
  kable_styling(full_width = F) %>%
  column_spec(1:3, background = "yellow")
```
---

# Improving summary output

Using the `within` function, you can remove column names from the output

<br><br>

``` {r, echo=-3, include =TRUE, collapse=TRUE}
LOS_summary <-  within(LOS_model, rm(ID,Organisation))
LOS_without_columns <- summary(LOS_summary)

LOS_without_columns
```

---

# Activity 3

+ If you wish to use Markdown for making reports that are specific to your trust, why not start by making a suitable template today!
+ In the `Activity_3_complete.css` CSS file in the library, you will see some part customisation towards 'HED' colours.  
+ All I have done here is change a few elements around and it is now similar to HED's

---

# Messy HTML in Markdown!

<figure>
  <p> <img src='./Assets/HTML_in_R.png' 
  width=110% height=110%>
  <figcaption> In R Studio, HTML is not colour coded and blends in too easily
  </figcaption>
  </p>
</figure>


<figure>
  <p> <img src='./Assets/HTML_in_Atom.png' 
  width=110% height=110%>
  <figcaption> In programs like Atom, proper colour coding helps to seperate out 
  </figcaption>
  </p>
</figure>

<br>

It is not always necessary to use pure HTML tags in Markdown.  Fully removing HTML is not wise, as you lose some of the unique abilities & facilities it provides.

<br>

There is however a compromise...

---

# The compromise

<figure>
  <p> <img src='./Assets/Refined_HTML.png' 
  width=80% height=80%>
  <figcaption> The h4 tags have been replaced with four hashtags, which means the same thing in Markdown
  </figcaption>
  </p>
</figure>

<br>
<figure>
  <p> <img src='./Assets/Refined_HTML_output.png' 
  width=80% height=80%>
  <figcaption> Identical output to using the h4 tags
  </figcaption>
  </p>
</figure>

---

# Span tags

+ We have used `<p>` tags so far to enclose text
+ Span tags can be used to enclose multiple lines of text, saving time
+ You need to add a span reference in your CSS file.  You then use span tags in HTML sections

``` {CSS eval = FALSE}

# CSS coding
span {
  font-family: Verdana;
  font-size: 14px;
  color:darkblue;
}
```
``` {HTML eval = FALSE}
# HTML coding
<span>
  The report ahead outlines some key statistics involved in the Length of the Stay metric on a national basis.  The table you see next is a simple summary of key findings from this dataset.
</span>
```
<br>
<figure>
  <p> <img src='./Assets/Span_output.png' 
  width=100% height=100%>
  </p>
</figure>

---

# More adjustments

+ Span is just the start of what we can change.  We can adjust other parts of the CSS file
+ We have used properties in our `body` section that could interfere with our `span` tag
+ If you wanted to use a span tag to apply to all text, we would no longer need the 'p' tag in our CSS file
<br>

``` {CSS eval=FALSE}
body{
  border: 2px #94C11F;
  background-color: #fff;
  background-position: right top;
  background-image: url("Rightblox2.png");
  background-repeat: no-repeat;
  display: table-cell;
}
span {
  font-family: Verdana;
  font-size: 14px;
  color:darkblue;
}
```

<br>
<br>
The body tag no longer includes references to the text size, colour or style.

The span tag now includes the font details that were in the previous 'body' tag

---

# Classes vs element selectors

+ Reminder - No dot before a selector means it <i> directly</i> affects a HTML element
<br><br>
Example -
``` {CSS eval=FALSE}
p{
  font-family:Arial;
}
```
<br><br>
+ This is the approach we have taken so far in the CSS section.  Now we will look at classes
+ A class in CSS has a dot before the selector, which has to be specifically referred to in the HTMLK

---
# Using classes with lists

.pull-left[

``` {CSS eval=FALSE}

# CSS

.listformat {
  font-family: Arial;
  font-size: 14px;
  color: darkgreen;
}
```
``` {HTML eval=FALSE}
# HTML

<span class ="listformat>
Your text to go here
Your text to go here
Your text to go here
Your text to go here
</span>
```

<br>
<figcaption> A new class has been added here called 'listformat' (can be called whatever you wish). <br><br>  This is then referred to in the HTML tags by using the 'class' addition to the right of the word 'span'. </figcaption>
]
.pull-right[
<figure>
  <p> <img src='./Assets/Classes_output.png' 
  width=150% height=150%>
  </p>
  <figcaption> The output from running the HTML & CSS</figcaption>
</figure>
]

---

#Tidied up further

.pull-left[

``` {HTML eval=FALSE}
# HTML

<body() class ="listformat>
Your text to go here
Your text to go here
Your text to go here
Your text to go here
</span>
```

<br>
<figcaption> The R HTML/Markdown code used with the new class structure </figcaption>
]
.pull-right[
<figure>
  <p> <img src='./Assets/Classes_output_body.png' 
  width=150% height=150%>
  </p>
  <figcaption> The new output using the 'body' class</figcaption>
</figure>
]

---

#Space: The Final Frontier


<figure>
  <p> <img src='./Assets/Space_incorrect.png' 
  width=100% height=100%>
  </p>
</figure>


<figure>
  <p> <img src='./Assets/Space_correct.png' 
  width=100% height=100%>
  </p>
</figure>

<br>
<br>
Warning!  The span tag in Markdown in particular is VERY sensitive to extra and unnecessary spaces/line breaks! For example -

---

#Activity 4 - Combining Markdown & HTML

+ Refine your R Markdown file so that it has a 'best of both worlds' approach - some Markdown, some HTML
+ Use HTML if you have something in particular in mind that you would like to do in Markdown that isn't possible with built-in options, but, for straight forward text and titles, tags can be overkill

## Extended

+ We haven't used these so far, but you may find 'div' tags useful, 
+ Or, using the newer HTML5 standards, the layout elements such as 'header' & 'section'
+ These all allow for your page to be split up into sections, personalising each part
+ Try it yourself!  Feel free to look at `styles(Activity_4_complete).css` and `CSS_Activity_4_complete.rmd`

---

# Kable

+ Kable is an R package that allows for advanced table formatting
+ 'Standard' views of tables can be dull without any styling applied
+ Kable code is simple and allows for easy, pleasurable output

``` {r, include=TRUE, echo=TRUE, warning =FALSE}
library(kableExtra)
dt <-  LOS_model
head(dt) %>%    # Only shows the first 6 lines of the table
  kable %>% 
  kable_styling()   # Applies the 'Twitter' bootstrap styling
```

---

# More Kable

``` {r, include=TRUE, echo=TRUE, warning =FALSE}

dt[1:2, 1:5] %>%    
  kable %>% 
            # The additional parameters in the line below adds striping to the table and stops
            # it from spreading across the full page (this is overridden by our CSS file)
  kable_styling(bootstrap_options="striped", full_width = F) 
  

```

## Activity 5

+ Convert a table that you have already loaded into R into Kable format.  
+ You can use the example I have shown and stick to the same styling or experiment with other Kable options
+ Look at the vignette -`vignette("awesome_table_in_html")`

---

# Using images

+ Inserting images is an inevtiable requirement
+ Like other CSS/HTML elements, you can apply properties in image tags across all images
+ The image example looked at so far for our CSS background is  different to how it is done elsewhere in HTML
+ If you have used the `align` attribute in the past, HTML5 has changed things...

.pull-left[
```{HTML eval=FALSE}
.center {
  display:block;
  margin-left: auto;
  margin-right: auto;
  width: 50%
}

<section>
  <p> <img src = "./Assets/hospital_bed.jpeg" width = 100% class="center"> </p>
</section> 
```
]
.pull-right[
<section>
  <p> <img src = "./Assets/hospital_bed.jpeg" 
  width = 100% 
  class="center"> 
  </p>
</section> 
]

---

# Figures and captions

+ You can make reports more professional by using a 'figures' and 'captions' approach
+ Needs a little more coding, but it's well worth it!
``` {CSS eval = FALSE}
# CSS coding

figure {
  float: left;
  border: thin silver solid;
  margin: 0.5em;
  padding: 0.5em;
}
img.scaled {
  width: 50%;
}
figcaption {
  font-size: 0.9em;
  font-style: italic;
  color: grey;
  margin-right: 10%;
  margin-left: 10%;
  text-align: center;
}
```

--

``` {HTML eval=FALSE}
# HTML coding

<figure>
  <p><img src= "hospital_bed.jpeg"
  width= 50% height=50%
  class = "center"
    alt="Hospital bed">
  <figcaption> As of September 2019, the average length of stay in England's NHS hospitals is 4.52 days </figcaption>
</figure>
```

---

# Output of figures & captions

<figure>
  <p><img src= "/Assets/figure_caption_output.png"
  width= 100% height=100%
</figure>


---

# Activity 6

+ Add in a figure with an appropriate caption of your choice to your Markdown and CSS file.  
+ You will need to add in a new section to your CSS file to do this - a 'figure' one and a 'figcaption' one
+ If you wish to extend this further, you can also add in some 'normal' images that are not figures
+ There are ways to do this in Markdown without using HTML tags, but this session revolves specifically around the use of these!
+ An example of how to do this can be found in the file `CSS_Activity_6.rmd` on line 78



---
  
  
# Closing remarks

+ We have built a CSS file here in stages to see what individual components do 
+ One of the best ways to learn is to experiment with an existing CSS file and make changes

